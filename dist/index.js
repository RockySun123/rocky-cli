"use strict";var e=require("tslib"),r=require("commander"),o=require("@inquirer/prompts"),i=require("simple-git"),t=require("progress-estimator"),n=require("chalk"),c=require("node:path"),s=require("fs-extra"),l=require("axios"),a=require("lodash"),u="0.0.4";const d=t({spinner:{interval:100,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"].map((e=>n.green(e)))}}),g={baseDir:process.cwd(),binary:"git",maxConcurrentProcesses:6,trimmed:!1},m=r=>e.__awaiter(void 0,void 0,void 0,(function*(){const{data:o}=yield(i=r,e.__awaiter(void 0,void 0,void 0,(function*(){const e=`https://registry.npmjs.org/${i}`;let r={};try{r=yield l.get(e)}catch(e){console.error(e)}return r})));var i;return o["dist-tags"].latest})),v=new Map([["vite-vue3-typescript-template",{name:"vite-vue3-typescript-template",downloadUrl:"git@gitee.com:sun-kelin/vue-infrastructure.git",description:"Vue3 技术栈开发模版",branch:"master"}],["vite-template",{name:"vite-react-typescript-template",downloadUrl:"git@gitee.com:sun-kelin/vue-infrastructure.git",description:"Vue 技术栈开发模版",branch:"dev-rocky"}]]);function p(r){return e.__awaiter(this,void 0,void 0,(function*(){const t=Array.from(v).map((e=>{const[r,o]=e;return{name:r,value:r,description:o.description}}));r||(r=yield o.input({message:"请输入项目名称"}));const l=c.resolve(process.cwd(),r);if(s.existsSync(l)){const i=yield(r=>e.__awaiter(void 0,void 0,void 0,(function*(){return console.warn(`${r} 文件夹已存在`),o.select({message:"是否覆盖",choices:[{name:"覆盖",value:!0},{name:"取消",value:!1}]})})))(r);if(!i)return;s.removeSync(l)}yield((r,o)=>e.__awaiter(void 0,void 0,void 0,(function*(){const e=yield m(r),i=a.gt(e,o);return i&&(console.warn(`检测到最新版本：${n.blueBright(e)}, 当前版本：${n.blueBright(o)}`),console.log(`可使用：${n.yellow("npm install rockys-cli@latest -g")}, 或者使用：${n.yellow("rockys update")} 更新`)),i})))("rockys-cli",u);const p=yield o.select({message:"请选择模版",choices:t}),y=v.get(p);y&&(yield((r,o,t)=>e.__awaiter(void 0,void 0,void 0,(function*(){const e=i(g);try{yield d(e.clone(r,o,t),"代码下载中...",{estimate:7e3}),console.log(""),console.log(n.blueBright("============================")),console.log(n.blueBright("= 欢迎使用 rocky-cli脚手架 =")),console.log(n.blueBright("============================")),console.log(""),console.log(n.blackBright("项目创建成功"),n.blueBright(o)),console.log(n.blackBright("请按照以下步骤进行操作:")),console.log(n.blackBright("cd ",n.blueBright(o))),console.log(n.yellowBright("pnpm ",n.blackBright("install"))),console.log(n.yellowBright("pnpm ",n.blackBright("run dev")))}catch(e){console.error(n.red("下载失败")),console.log(e)}})))(y.downloadUrl,r,["-b",y.branch]))}))}const y=new r.Command;y.name("rocky").description("自定义脚手架").version(u,"-v, --version"),y.command("create").description("创建新项目").argument("[name]","项目名称").action((function(r){return e.__awaiter(this,void 0,void 0,(function*(){p(r)}))})),y.parse();
