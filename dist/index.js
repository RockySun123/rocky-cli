"use strict";var e=require("tslib"),o=require("commander"),r=require("@inquirer/prompts"),i=require("simple-git"),t=require("progress-estimator"),n=require("chalk"),c=require("node:path"),s=require("fs-extra"),l=require("axios"),a=require("lodash"),d=require("node:child_process"),u=require("ora"),g="0.0.5";const v=t({spinner:{interval:100,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"].map((e=>n.green(e)))}}),m={baseDir:process.cwd(),binary:"git",maxConcurrentProcesses:6,trimmed:!1},p=o=>e.__awaiter(void 0,void 0,void 0,(function*(){const{data:r}=yield(i=o,e.__awaiter(void 0,void 0,void 0,(function*(){const e=`https://registry.npmjs.org/${i}`;let o={};try{o=yield l.get(e)}catch(e){console.error(e)}return o})));var i;return r["dist-tags"].latest})),y=new Map([["vite-vue3-typescript-template",{name:"vite-vue3-typescript-template",downloadUrl:"git@gitee.com:sun-kelin/vue-infrastructure.git",description:"Vue3 技术栈开发模版",branch:"master"}],["vite-template",{name:"vite-react-typescript-template",downloadUrl:"git@gitee.com:sun-kelin/vue-infrastructure.git",description:"Vue 技术栈开发模版",branch:"dev-rocky"}]]);function h(o){return e.__awaiter(this,void 0,void 0,(function*(){const t=Array.from(y).map((e=>{const[o,r]=e;return{name:o,value:o,description:r.description}}));o||(o=yield r.input({message:"请输入项目名称"}));const l=c.resolve(process.cwd(),o);if(s.existsSync(l)){const i=yield(o=>e.__awaiter(void 0,void 0,void 0,(function*(){return console.warn(`${o} 文件夹已存在`),r.select({message:"是否覆盖",choices:[{name:"覆盖",value:!0},{name:"取消",value:!1}]})})))(o);if(!i)return;s.removeSync(l)}yield((o,r)=>e.__awaiter(void 0,void 0,void 0,(function*(){const e=yield p(o),i=a.gt(e,r);return i&&(console.warn(`检测到最新版本：${n.blueBright(e)}, 当前版本：${n.blueBright(r)}`),console.log(`可使用：${n.yellow("npm install rockys-cli@latest -g")}, 或者使用：${n.yellow("rockys update")} 更新`)),i})))("rockys-cli",g);const d=yield r.select({message:"请选择模版",choices:t}),u=y.get(d);u&&(yield((o,r,t)=>e.__awaiter(void 0,void 0,void 0,(function*(){const e=i(m);try{yield v(e.clone(o,r,t),"代码下载中...",{estimate:7e3}),console.log(""),console.log(n.blueBright("============================")),console.log(n.blueBright("= 欢迎使用 rocky-cli脚手架 =")),console.log(n.blueBright("============================")),console.log(""),console.log(n.blackBright("项目创建成功"),n.blueBright(r)),console.log(n.blackBright("请按照以下步骤进行操作:")),console.log(n.blackBright("cd ",n.blueBright(r))),console.log(n.yellowBright("pnpm ",n.blackBright("install"))),console.log(n.yellowBright("pnpm ",n.blackBright("run dev")))}catch(e){console.error(n.red("下载失败")),console.log(e)}})))(u.downloadUrl,o,["-b",u.branch]))}))}const w=u({text:"rockys-cli 正在更新中...",spinner:{interval:100,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"].map((e=>n.green(e)))}}),b=new o.Command;b.name("rocky").description("自定义脚手架").version(g,"-v, --version"),b.command("create").description("创建新项目").argument("[name]","项目名称").action((function(o){return e.__awaiter(this,void 0,void 0,(function*(){h(o)}))})),b.command("update").description("更新脚手架").action((()=>e.__awaiter(void 0,void 0,void 0,(function*(){yield e.__awaiter(void 0,void 0,void 0,(function*(){return w.start(),d.exec("npm install rockys-cli@latest -g",((e,o)=>{w.stop(),e?(console.log(n.red("更新失败")),console.log(e)):console.log(n.green("更新成功"))}))}))})))),b.parse();
